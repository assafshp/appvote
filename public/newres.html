<!DOCTYPE html>
<html dir="rtl" lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>X-Labs 2021</title>
    <!-- <link rel="preconnect" href="https://fonts.gstatic.com"> -->
    <!-- <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet"> -->
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/media-queries.css" />
</head>

<body>

    <!-- APP -->
    <div id="app">
        <div class="app-overlay"></div>
        <!-- HEADER -->
        <header>
            <!-- <a href="#topAnchor"></a>  -->

            <div id="xlogo" class="logo logo-res">
                <img src="images/xlabs_icon.png">
            </div>
        </header>
        <!-- MAIN -->
        <main>

            <h1 id="main" class="main-title">והתוצאות</h1>
            <h5 id="main1" class="main-title2">המיזמים הצליחו לגייס:</h5>
            <div id="cards" class="cards-res" style="opacity: 1;">
                <div class="card-res" id="0">
                    <div class="card-info-res">
                        <div class="candidate-info">
                            <h1>מיזם</h1>
                        </div>
                        <div class="candidate-info">
                            <img src="images/trophy.png" class="app-logo dollar undefined">
                        </div>
                        <div class="candidate-info">
                            <img src="images/dollar.png" class="app-logo dollar undefined">
                        </div>
                        <div class="candidate-info">
                            <img src="images/people.png" class="app-logo undefined">

                        </div>
                    </div>
                    <div class="card-info-res">
                        <div class="candidate-info">
                            <img src="images/miba.png" class="app-logo-res undefined">
                        </div>
                        <div class="candidate-info">
                            <img id="mibawin" src="images/winner.png" style="display:none;width: 4rem;">
                        </div>
                        <div class="candidate-info">
                            <h1 id="mibacount" class=""></h1>
                        </div>
                        <div class="candidate-info">
                            <h1 id="mibaamount" class=""></h1>
                        </div>
                    </div>
                    <div class="card-info-res">
                        <div class="candidate-info">
                            <img src="images/yarok.png" class="app-logo-res undefined">
                        </div>
                        <div class="candidate-info">
                            <img id="yarockwin" src="images/winner.png" style="display:none;width: 4rem;">
                        </div>
                        <div class="candidate-info">
                            <h1 id="yarockcount" class=""></h1>
                        </div>
                        <div class="candidate-info">
                            <h1 id="yarockamount" class=""></h1>
                        </div>
                    </div>
                    <div class="card-info-res">
                        <div class="candidate-info">
                            <img src="images/beenthere.png" class="app-logo-res undefined">
                        </div>
                        <div class="candidate-info">
                            <img id="beentherewin" src="images/winner.png" style="display:none;width: 4rem;">
                        </div>
                        <div class="candidate-info">
                            <h1 id="beentherecount" class=""></h1>
                        </div>
                        <div class="candidate-info">
                            <h1 id="beenthereamount" class=""></h1>
                        </div>
                    </div>
                </div>




            </div>
            <div id="endvote" class="main-title endvote" style="display: none;">
                <h4 class="end-text">מעולה, תודה רבה ! </h4>
                <div>
                    <img class="xlabs-logo" src="images/xlabs_icon.png">
                </div>
            </div>
        </main>
    </div>
</body>
<script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-app.js"></script>
<script defer src="https://www.gstatic.com/firebasejs/8.6.1/firebase-firestore.js"></script>
<script>
     let results = {};

    const loadEl = document.querySelector('#main');
    const loadEl1 = document.querySelector('#main1');

    let inviteeName = '';
    let voteCount = 0;

    var firebaseConfig = {
        apiKey: "AIzaSyBGvPBIU_J7NHpUqAYxmJm7XHs8JQDJzbQ",
        authDomain: "xappvote.firebaseapp.com",
        projectId: "xappvote",
        storageBucket: "xappvote.appspot.com",
        messagingSenderId: "582541238903",
        appId: "1:582541238903:web:c6ccd79e010899408ddc72"
    };

    var app;
    var db;

    const urlParams = new URLSearchParams(window.location.search);
    const phone = urlParams.get('p') || true;
    console.log(`phone=${phone}`);
    const type = urlParams.get('t');
    let votes = {};
    let event = {};


    let candidates = [
        {
            id: 0,
            name: "MiBa",
            img: "miba.png"
        },
        {
            id: 1,
            name: "YaRock",
            img: "yarok.png",
            class: "yarok"
        },
        {
            id: 2,
            name: "BeenThere",
            img: "beenthere.png"
        }

    ]

    function resultsView(results, winnerName){

        document.getElementById('mibacount').innerText=results.miba.count;
        document.getElementById('mibaamount').innerText=results.miba.amount;

        document.getElementById('yarockcount').innerText=results.yarock.count;
        document.getElementById('yarockamount').innerText=results.yarock.amount;

        document.getElementById('beentherecount').innerText=results.beenthere.count;
        document.getElementById('beenthereamount').innerText=results.beenthere.amount;

        switch (winnerName) {
            case 'miba':
                document.getElementById('mibawin').style.display='';        
                break;
            case 'yarock':
                document.getElementById('yarockwin').style.display='';        
                break;
            case 'beenthere':
                document.getElementById('beentherewin').style.display='';        
                break;
            default:
                break;
        }
    }


    document.addEventListener('DOMContentLoaded', async () => {

        try {
            app = firebase.initializeApp(firebaseConfig);
            db = firebase.firestore(app);

            // const loadEl = document.querySelector('#main');
           


            if (phone) {
              
                let winnerCount =0;
                let winnerName ='';

                await db.collection("results").get().then((querySnapshot) => {
                    querySnapshot.forEach((doc) => {
                        // doc.data() is never undefined for query doc snapshots
                        const groupResult = doc.data();
                        console.log(doc.id, " => ", groupResult);
                        results[doc.id] = groupResult;
                        if (groupResult.count > winnerCount) {
                            winnerCount = groupResult.count;
                            winnerName = groupResult.name;
                        }
                    });
                });
                console.log(results);
                console.log(winnerName);
                resultsView(results, winnerName.toLowerCase());
                
            }

            switch (type) {
                default:
                    // loadEl.textContent = 'זה הזמן להשפיע';
                    // loadEl1.textContent = 'אנא הצבע/י לכל אחד מהמיזמים';
                    // const cards = document.querySelector('.cards');
                    // document.getElementById('cards').style.opacity = 0;
                    // cards.innerHTML = getCards();
                    // document.getElementById('cards').style.opacity = 1;
                    break;
            }
        } catch (e) {
            console.error(e);
            loadEl.textContent = 'Error';
        }
    });
</script>

<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.4.0/dist/confetti.browser.min.js"></script>


</html>